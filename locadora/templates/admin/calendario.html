{% extends 'base.html' %}

{% block title %}Calendário de Reservas - Admin{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <!-- Cabeçalho do Calendário -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h3 fw-bold text-primary">
                    <i class="fas fa-calendar-alt me-2"></i>Calendário de Reservas
                </h1>
                <div class="d-flex align-items-center gap-2">
                    <span class="badge bg-secondary">
                        {{ total_reservas_mes }} reservas este mês
                    </span>
                    <div class="btn-group">
                        <a href="?ano={{ mes_anterior.0 }}&mes={{ mes_anterior.1 }}" 
                           class="btn btn-outline-primary">
                            <i class="fas fa-chevron-left"></i>
                        </a>
                        <span class="btn btn-primary">{{ mes_nome }} de {{ ano }}</span>
                        <a href="?ano={{ mes_proximo.0 }}&mes={{ mes_proximo.1 }}" 
                           class="btn btn-outline-primary">
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Legenda -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="d-flex gap-3">
                        <span class="badge bg-primary">
                            <i class="fas fa-arrow-right me-1"></i>Retirada
                        </span>
                        <span class="badge bg-success">
                            <i class="fas fa-arrow-left me-1"></i>Devolução
                        </span>
                        <span class="badge bg-warning text-dark">
                            <i class="fas fa-calendar-day me-1"></i>Hoje
                        </span>
                    </div>
                </div>
            </div>

            <!-- Calendário SIMPLIFICADO -->
            <div class="card border-0 shadow">
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-bordered mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="text-center">Dom</th>
                                    <th class="text-center">Seg</th>
                                    <th class="text-center">Ter</th>
                                    <th class="text-center">Qua</th>
                                    <th class="text-center">Qui</th>
                                    <th class="text-center">Sex</th>
                                    <th class="text-center">Sáb</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for semana in semanas %}
                                <tr>
                                    {% for dia in semana %}
                                    
                                    {% if dia.vazio %}
                                    <!-- Dia vazio do calendário -->
                                    <td class="p-2 bg-light" style="height: 120px;"></td>
                                    
                                    {% else %}
                                    <!-- Dia com conteúdo -->
                                    <td class="p-2 {% if dia.e_hoje %}bg-warning bg-opacity-10{% endif %}" 
                                        style="height: 120px; vertical-align: top;">
                                        
                                        <div class="d-flex justify-content-between align-items-start">
                                            <span class="fw-bold {% if dia.e_hoje %}text-warning{% endif %}">
                                                {{ dia.dia_numero }}
                                            </span>
                                            
                                            {% if dia.contagem_reservas > 0 %}
                                            <span class="badge bg-primary rounded-pill">
                                                {{ dia.contagem_reservas }}
                                            </span>
                                            {% endif %}
                                        </div>
                                        
                                        <!-- Reservas do dia -->
                                        {% if dia.reservas %}
                                        <div class="mt-2">
                                            {% for reserva_info in dia.reservas %}
                                            <div class="badge {{ reserva_info.classe }} mb-1 d-block text-start small p-2"
                                                 data-bs-toggle="tooltip" 
                                                 title="{{ reserva_info.tooltip }}"
                                                 style="cursor: help;">
                                                <i class="fas fa me-1"></i>
                                                {{ reserva_info.texto }}
                                            </div>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                        
                                    {% endif %}
                                    
                                    </td>
                                    {% endfor %}
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Estatísticas -->
            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body">
                            <h6 class="card-title">
                                <i class="fas fa-info-circle me-2 text-primary"></i>
                                Como usar o calendário
                            </h6>
                            <ul class="small mb-0">
                                <li>Cada badge colorido representa uma reserva</li>
                                <li><span class="badge bg-primary">Azul</span> = Retirada do veículo</li>
                                <li><span class="badge bg-success">Verde</span> = Devolução do veículo</li>
                                <li>Passe o mouse sobre um badge para ver detalhes</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body">
                            <h6 class="card-title">
                                <i class="fas fa-chart-bar me-2 text-primary"></i>
                                Resumo do Mês
                            </h6>
                            <div class="row small">
                                <div class="col-6">
                                    <strong>Reservas:</strong> {{ total_reservas_mes }}
                                </div>
                                <div class="col-6">
                                    <strong>Mês:</strong> {{ mes_nome }}/{{ ano }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Ativar tooltips
    var tooltips = document.querySelectorAll('[data-bs-toggle="tooltip"]');
    tooltips.forEach(function(element) {
        new bootstrap.Tooltip(element);
    });
    
    // Adicionar clique nos badges para abrir detalhes
    var badges = document.querySelectorAll('.badge[data-bs-toggle="tooltip"]');
    badges.forEach(function(badge) {
        badge.addEventListener('click', function() {
            var title = this.getAttribute('title');
            if(title) {
                alert('Detalhes da reserva:\n' + title);
            }
        });
    });
});
</script>

<style>
.table td {
    transition: background-color 0.2s;
}

.table td:hover {
    background-color: rgba(0, 0, 0, 0.02);
}

.badge {
    transition: transform 0.2s;
}

.badge:hover {
    transform: scale(1.05);
}
</style>
{% endblock %}